create sequence hibernate_sequence start 1 increment 1;
create table accepted_solution (id int8 not null, version int8 not null, script text not null, score int4 default 0 not null, context_id int8, json_result text not null, storetime timestamp not null, firsttime timestamp, oid_id int8 not null, challenge_id int8 not null, primary key (id));
create table classroom (id int8 not null, version int8 not null, teacher_id int8 not null, guid varchar(255) not null, primary key (id));
create table classroom_oidentity (classroom_students_id int8 not null, oidentity_id int8, students_idx int4);
create table content_item_ref (id int8 not null, version int8 not null, domain_ref_id int8 not null, name varchar(255) not null, type varchar(255) not null, primary key (id));
create table content_tree_ref (id int8 not null, version int8 not null, tree_version varchar(255) not null, primary key (id));
create table course_ref (id int8 not null, version int8 not null, domain_ref_id int8 not null, name varchar(255) not null, primary key (id));
create table diploma (id int8 not null, version int8 not null, name varchar(255) not null, date_received timestamp not null, oid_id int8 not null, guid varchar(255) not null, primary key (id));
create table domain_ref (id int8 not null, version int8 not null, name varchar(255) not null, tree_ref_id int8 not null, primary key (id));
create table progress (id int8 not null, version int8 not null, itemref_id int8 not null, oid_id int8 not null, guid varchar(255) not null, primary key (id));
create table registration_code (id int8 not null, date_created timestamp not null, username varchar(255) not null, token varchar(255) not null, primary key (id));
create table requestmap (id int8 not null, version int8 not null, config_attribute varchar(255) not null, url varchar(255) not null, primary key (id));
create table sec_role (id int8 not null, version int8 not null, authority varchar(255) not null, primary key (id));
create table sec_user (id int8 not null, version int8 not null, pwd varchar(255) not null, password_expired boolean not null, account_locked boolean not null, account_expired boolean not null, enabled boolean not null, email varchar(255) not null, class varchar(255) not null, locale varchar(255), managed_pwd varchar(255), registrationdate timestamp, birthdate timestamp, guid varchar(255), nick varchar(64), primary key (id));
create table sec_user_sec_role (sec_user_id int8 not null, sec_role_id int8 not null, primary key (sec_user_id, sec_role_id));
create table stored_solution (id int8 not null, version int8 not null, script text not null, accepted boolean default false not null, score int4 default 0 not null, oid_id int8 not null, json_result text not null, context_id int8, storetime timestamp not null, firsttime timestamp, counter int4 default 0 not null, challenge_id int8 not null, primary key (id));
create table storyline_item_ref (id int8 not null, version int8 not null, storyline_ref_id int8 not null, seqnr int4 not null, primary key (id));
create table storyline_ref (id int8 not null, version int8 not null, course_ref_id int8 not null, name varchar(255) not null, primary key (id));
create table token (id int8 not null, version int8 not null, valid_until timestamp not null, role varchar(255) not null, voucher_id int8 not null, access_type varchar(255) not null, received_on timestamp not null, guid varchar(255) not null, tokens_idx int4, primary key (id));
create table voucher (id int8 not null, version int8 not null, sold_on timestamp, generated_on timestamp not null, sponsor varchar(255) not null, days_valid int4 not null, vid varchar(255) not null, role varchar(255) not null, access_type varchar(255) not null, amount int4 not null, guid varchar(255) not null, primary key (id));
create table voucher_desktop_licenses (voucher_id int8 not null, desktop_licenses_string varchar(255), desktop_licenses_idx int4);
create table voucher_voucher (voucher_vouchers_id int8, voucher_id int8, vouchers_idx int4);
create table wallet (id int8 not null, version int8 not null, desktop_license_key varchar(255), oid_id int8 not null, guid varchar(255) not null, primary key (id));
create table wallet_oidentity (wallet_teachers_id int8 not null, oidentity_id int8, teachers_idx int4);
create table wallet_token (wallet_tokens_id int8 not null, token_id int8, tokens_idx int4);
create table wallet_voucher (wallet_vouchers_id int8 not null, voucher_id int8, vouchers_idx int4);
create index lnk_as_context_oid on accepted_solution (context_id, oid_id);
create index lnk_as_challenge_oid on accepted_solution (oid_id, challenge_id);
create index lnk_clsrm_teacher on classroom (teacher_id);
create index lnk_pg_oid on progress (oid_id);
alter table requestmap add constraint UK_26v03gjht0pvthrnhv99bbgvn unique (url);
alter table sec_role add constraint UK_oah023x2ltqw09mdue7w0mcxb unique (authority);
create index lnk_oi_guid on sec_user (guid);
alter table sec_user add constraint UK_numjsbs0wblvnqi7po8eyeo6y unique (email);
create index lnk_ss_context_oid_accepted on stored_solution (accepted, oid_id, context_id);
create index lnk_ss_challenge_oid on stored_solution (oid_id, challenge_id);
create index lnk_wl_oid on wallet (oid_id);
alter table accepted_solution add constraint FK25lrmbfey6qffv4x4xaisomyq foreign key (context_id) references storyline_item_ref;
alter table accepted_solution add constraint FKoh1ir2seq1yajrwjr3dfjo50m foreign key (oid_id) references sec_user;
alter table accepted_solution add constraint FK33mcjg5owg30m6lluutfwerdb foreign key (challenge_id) references content_item_ref;
alter table classroom add constraint FK214vroymgbxytc0x71u19a4jv foreign key (teacher_id) references sec_user;
alter table classroom_oidentity add constraint FK5f48lbfj56q064rqx03paeqd8 foreign key (oidentity_id) references sec_user;
alter table content_item_ref add constraint FKcest0v4d7mbt0jg1sxxh35sxb foreign key (domain_ref_id) references domain_ref;
alter table course_ref add constraint FK4qog5fdy7edilmqng67c1aay5 foreign key (domain_ref_id) references domain_ref;
alter table diploma add constraint FKmsba8dlnjtn7vtxfry0rs896d foreign key (oid_id) references sec_user;
alter table domain_ref add constraint FK7u6ss3utk4g9r0dkqej3qq8yv foreign key (tree_ref_id) references content_tree_ref;
alter table progress add constraint FK5bn7gpt15quu9fy5x23iyan5g foreign key (itemref_id) references storyline_item_ref;
alter table progress add constraint FKdqabaf0ab54xngii79t2e7en0 foreign key (oid_id) references sec_user;
alter table sec_user_sec_role add constraint FK81r3vb2e9li23kwl9ykbo2l05 foreign key (sec_user_id) references sec_user;
alter table sec_user_sec_role add constraint FKf4m8563aw7lu33q9g25hf1kaf foreign key (sec_role_id) references sec_role;
alter table stored_solution add constraint FKnnbf9p7teitso8tynmkjdrnls foreign key (oid_id) references sec_user;
alter table stored_solution add constraint FKajxbv7ud687sau8nfic69j10o foreign key (context_id) references storyline_item_ref;
alter table stored_solution add constraint FKdl5p7ryx8rv75l6nxi9ptiuc8 foreign key (challenge_id) references content_item_ref;
alter table storyline_item_ref add constraint FK7yys572wg754g4oiquotgyad5 foreign key (storyline_ref_id) references storyline_ref;
alter table storyline_ref add constraint FKqdtywodbdnoyecltmxu9i8469 foreign key (course_ref_id) references course_ref;
alter table token add constraint FK57lhcxiaxrpmywqe0ulv1t4bo foreign key (voucher_id) references voucher;
alter table voucher_voucher add constraint FKtn64seyfwm1hwnakweol0e8j0 foreign key (voucher_id) references voucher;
alter table wallet add constraint FK90icps2n6r106y4nbo6w7ujkm foreign key (oid_id) references sec_user;
alter table wallet_oidentity add constraint FKk16bsdhorfthuw7r8ir9goidk foreign key (oidentity_id) references sec_user;
alter table wallet_token add constraint FKpup7or4h8glmou4x3sfoyd0wi foreign key (token_id) references token;
alter table wallet_voucher add constraint FKedusy8hlnyplr31ed8da3a5pv foreign key (voucher_id) references voucher;
